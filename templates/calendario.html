
{% extends "layout.html" %}

{% block title %}
    Calendario
{% endblock %}

{% block main %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (document.getElementById('calendar')) {
            const eventosDoFlask = {{ eventos | tojson | safe }};

            const calendar = new window.FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                events: eventosDoFlask,
                dateClick: function(info) {
                    const titulo = prompt("Título do evento:");
                    if (titulo) {
                        const data = new Date(info.dateStr);
                        const dia = data.getDate();
                        const mes = data.getMonth() + 1;

                        fetch("/calendario", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                dia: dia,
                                mes: mes,
                                titulo: titulo,
                                texto: ""
                            })
                        }).then(res => res.json())
                          .then(data => {
                              if (data.status === "ok") {
                                  calendar.addEvent({
                                      title: titulo,
                                      start: info.dateStr
                                  });
                              }
                          });
                    }
                }
            });

            calendar.render();
        }
    });
</script>


    <div id='calendar'></div>

<h2>Adicionar Evento</h2>
    <form method="post" class="calendario-form">
        <p>Dia</p>
        <input type="number" name="dia" placeholder="Dia">
        <p>Mês</p>
        <input type="number" name="mes" placeholder="Mês">
        <p>Titulo</p>
        <input type="text" name="titulo" placeholder="Título">
        <p>Texto</p>
        <input type="text" name="texto" placeholder="Texto">
        <button type="submit">Adicionar</button>
    </form>
    <h2>Deletar Evento</h2>
    <form method="post" class="calendario-form">
        <input type= "hidden" name="delete" value="delete">
        
        <p>Titulo</p>
        <input type="text" name="titulo" placeholder="Título">
        
        <button type="submit">Deletar</button>
    </form>
    

{% endblock %}
